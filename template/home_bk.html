<!DOCTYPE html>
<html lang="en">
<head>
<title>Chat Example</title>
<link rel="stylesheet" type="text/css" href="http://pre-cdn.ggac.net/lib/css/toastr-2.1.3.min.css">
<link rel="stylesheet" type="text/css" href="static/css/chat.css">
</head>
<body>
    <div id="app" v-cloak>
        <div id="searchBox">
            <div class="search-input">
                <input type="text" name="search" v-model="search_data" placeholder="搜索">
                <span class="search-icon" @click="submitSearch"><img src="http://cdn.ggac.net/images/seacher_icon.png"></span>
            </div>
            <div class="switch-condition">
                <a href="javascript:;" class="room-contact font-size12" @click="get_room_list(false,search_data)">联系人<span class="roomlist-unread-count font-size12" v-if="room_list_unread_count>0">{{ room_list_unread_count }}</span></a>
                <a href="javascript:;" class="font-size12" @click="get_user_focus_list()">关注人</a>
            </div>
        </div>
        <div id="roomList" v-show="navbar_type=='room_list'">
            <template v-for="(r, index) in rooms">
                <div class="room-box" :class="{'is-active' : r.isActive}"  @click="changeRoom(r.rid)">
                    <div class="sidebar-avatar-box">
                        <img :src="image_prefix + r.images" class="user-avatar"/>
                    </div>
                    <div class="sidebar-content-box">
                        <div class="r-content-top">
                            <span class="font-size14 r-desc">{{ r.des }}</span>
                            <span class="font-size14 r-date" >{{ r.create_date.split('.')[0].substring(11, 16) }}</span>
                        </div>
                        <div class="font-size14 r-latest-bottom" v-html="r.content"></div>
                        <span class="font-size14 r-badge" v-if="r.unread>0">{{ r.unread }}</span>
                        <span class="font-size14 r-remove" @click.stop="deleteRoom(r.rid)">X</span>
                    </div>
                </div>
            </template>
        </div>
        <div v-show="navbar_type=='room_list'">
            <div id="logTitle">
                <div class="title-info">
                    <span class="info-name font-size14">{{ current_room.des }}</span>
                    <span class="info-delete font-size14">X</span>
                </div>
            </div>
            <div id="log">
                <div v-for="message in messages">
                    <template v-if="message.hasOwnProperty('isDate')">
                        <div class="date-box">
                            <span class="font-size14">{{ message.create_date }}</span>
                        </div>
                    </template>
                    <template v-else>
                        <div class="self-box" v-if="user==parseInt(message.from_uid)">
                            <span class="font-size14 content-time">{{ message.create_date.split('.')[0] }}</span>
                                <span class="font-size14 content-body" v-html="message.content"></span>
                            <span class="content-header">
                                <img :src="image_prefix + message.image" class="user-avatar"/>
                            <span class="font-size14">{{message.from_name}}</span>
                            </span>
                        </div>
                        <div class="other-box" v-else>
                            <span class="content-header">
                                <img :src="image_prefix + message.image" class="user-avatar"/>
                            <span class="font-size14">{{message.from_name}}</span>
                            </span>
                                <span class="font-size14 content-body" v-html="message.content"></span>
                            <span class="font-size14 content-time">{{ message.create_date.split('.')[0] }}</span>
                        </div>
                    </template>

                </div>
            </div>
            <div id="form" v-if="has_connected" style="display: inline-block;">
                <div class="emoji-container" style="min-height: 30px;display: none;">
                    <span class="dismiss-emoji font-size12" onclick="dismissContainer()">X</span>
                    <table border="0" cellspacing="0" cellpadding="0">
                        <tbody>
                        <tr v-for="(rows, r_index) in emojiss">
                            <td v-for="(col, c_index) in rows">
                                <div class="emojis-item">
                                    <img :src="'http://pre-cdn.ggac.net/images/arclist/' + col + '.gif'" onclick="chatInertEmoji(event)" :_img_number="col">
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="contentBox" name="saytext" class="font-size14" contentEditable="plaintext-only" onpaste="toastr.warning('禁止粘贴数据');return false;" @keypress.enter="submitContent"></div>
                <img class="choose-img-btn" src="http://pre-cdn.ggac.net/images/fourm_face.png" onclick="chatChooseEmoji(event)">
                <input id="submitContent" type="button" @click="submitContent" value="Submit"/>
            </div>
        </div>
        <div id="focusList" v-show="navbar_type=='focus_list'">
            <template v-for="(r, index) in user_focus">
                <div class="room-box" :class="{'is-active' : r.id==current_user_focus.id}" @click="changeUserFocus(r)">
                    <div class="sidebar-avatar-box">
                        <img :src="image_prefix + r.avatar_image" class="user-avatar"/>
                    </div>
                    <div class="sidebar-content-box">
                        <div class="r-content-top">
                        <span class="font-size14 r-desc">{{ r.username }}</span>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        <div id="focusDetail" v-show="navbar_type=='focus_list'">
            <template v-if="user_focus.length>0">
                <div class="font-size14">{{current_user_focus.username}}关注人详情</div>
                <div class="operate-box">
                    <a href="javascript:;" class="font-size14" @click="sendUserFocus">发信息</a>
                </div>
            </template>
            <template v-else>
                <div class="font-size14">您还没有关注人</div>
            </template>
        </div>
    </div>
</body>
<script src="http://pre-cdn.ggac.net/lib/js/jquery-3.3.1.min.js"></script>
<script src="http://pre-cdn.ggac.net/lib/js/vue-2.5.13.min.js"></script>
<script src="http://pre-cdn.ggac.net/lib/js/toastr-2.1.3.min.js"></script>
<script src="static/js/chat.js"></script>
</html>
